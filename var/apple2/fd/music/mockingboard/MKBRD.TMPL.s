;
; PRIMARY ROUTINES, TABLE ACCESS ROUTINES, & SOUND EFFECTS
;
WAIT		=	$FCAB	        ;WAIT SUBROUTINE
;
; ADDRESSES FOR FIRST 6522
;
ORB             =       $C400           ;PORT B
ORA             =       $C401           ;PORT A
DDRB            =       $C402           ;DATA DIRECTION REGISTER (A)
DDRA            =       $C403           ;DATA DIRECTION REGISTER (B)
PTR		=	$08	        ;DATA POINTER
TONE		=	$0A	        ;TONAL VALUE
TIME		=	$0B	        ;TIME VALUE FOR DELAY
;
; ADDRESSES FOR SECOND 6522
;
ORB2            =       $C480           ;PORT B
ORA2            =       $C481           ;PORT A
DDRB2           =       $C482           ;DATA DIRECTION REGISTER (B)
DDRA2           =       $C483           ;DATA DIRECTION REGISTER (A)
PTR2		=	$0A	        ;DATA POINTER
;
; PRIMARY ROUTINES FOR SLOT 4
;
;
; ROUTINES FOR FIRST 6522
;
INIT            LDA     #$FF            ;SET PORT A FOR OUTPUT
                STA     DDRA
                LDA     #$07            ;SET PORT B FOR OUTPUT
                STA     DDRB
                RTS

LATCH           LDA     #$07            ;SEND "LATCH COMMAND"
                STA     ORB             ;TO SOUND CHIP
                LDA     #$04            ;THROUGH PORT B
                STA     ORB
                RTS

WRITE	        LDA	#$06		;SEND "WRITE COMMAND"
		STA	ORB		;TO SOUND CHIP
		LDA	#$04		;THROUGH PORT B
		STA	ORB
		RTS			;RETURN

RESET	        LDA	#$00		;SEND "RESET COMMAND"
		STA	ORB		;TO SOUND CHIP
		LDA	#$04		;THROUGH PORT B
		STA	ORB
		RTS			;RETURN
;
; ROUTINES FOR SECOND 6522
;
INIT2		LDA	#$FF		;SET PORT A FOR OUTPUT
		STA	DDRA2
		LDA	#$07		;SET PORT B FOR OUTPUT
		STA	DDRB2
		RTS			;RETURN

LATCH2	        LDA	#$07		;SEND "LATCH COMMAND"
		STA	ORB2		;TO SOUND CHIP
		LDA	#$04		;THROUGH PORT B
		STA	ORB2	
		RTS			;RETURN	

WRITE2	        LDA	#$06		;SEND "WRITE COMMAND"
		STA	ORB2		;TO SOUND CHIP
		LDA	#$04		;THROUGH PORT B
		STA	ORB2
		RTS			;RETURN

RESET2          STA	#$00		;SEND "RESET COMMAND"
		STA	ORB2		;TO SOUND CHIP
		LDA	#$04		;THROUGH PORT B
		STA	ORB2
		RTS			;RETURN
;
; TABLE ACCESS ROUTINE (TAR)
; FOR SLOT 4
;	
; ROUTINES FOR FIRST 6255
;
TAR_START       JSR	RESET	        ;RESET SOUND CHIP
		LDY	#$00	        ;USED TO IDENTIFY REGISTER
TAR_LOOP        STY	ORA	        ;# OF SOUND CHIP
		JSR	LATCH
		LDA	(PTR),Y	        ;GET DATA FROM TABLE
		STA	ORA
		JSR	WRITE	        ;STORE IN REGISTER
		CPY	#$0F	        ;END OF DATA?
		BEQ	DONE	        ;YES, EXIT
		INY
		JMP	TAR_LOOP        ;NO, GET NEXT SET
TAR_DONE        RTS		        ;RETURN
;	
; ROUTINES FOR SECOND 6522	
;	
TAR_START2      JSR	RESET2	        ;SAME INSTRUCTIONS AS 
		LDY	#$00	        ;ABOVE
TAR_LOOP2       STY	ORA2
		JSR	LATCH2
		LDA	(PTR2),Y
		STA	ORA2
		JSR	WRITE2
		CPY	#$0F
		BEQ	DONE2
		INY
		JMP	TAR_LOOP2
TAR_DONE2	RTS
;
; PROCESSOR LOOP
; FOR LASER AND BOMB
; SOUND EFFECT
;
; FOR FIRST 6522
;	
LASER	        LDA	#$00            ;LOAD HIGHEST
		STA	TONE	        ;FREQUENCY VALUE
		LDA	#$0F	        ;LOAD SHORT
		STA	TIME	        ;TIME DELAY
		JMP	EFFECTS_START   ;AND START
BOMB	        LDA	#$30            ;LOAD MIDDLE
		STA	TONE	        ;FREQUENCY VALUE
		LDA	#$40	        ;LOAD LONGER
		STA	TIME	        ;TIME DELAY
EFFECTS_START   LDA	#$90	        ;SET TABLE ADDRESS
		STA	PTR
		LDA	#$81
		STA	PTR+1
		JSR	TAR_START       ;TRANSFER DATA
		LDA	#$00	        ;LATCH FIRST REGISTER
		STA	ORA	        ;ADDRESS
		JSR	LATCH
EFFECTS_LOOP	LDA	TONE	        ;GET TONE VALUE
		JSR	WRITE
		LDA	TIME	        ;GET TIME VALUE	
		JSR	WAIT	        ;AND DELAY
		INC	TONE	        ;INCREMENT TONE VALUE
		LDA	#$FF	        ;END OF INCREASE?
		CMP	TONE
		BEQ	EFFECTS_DONE    ;YES,EXIT
		JMP	EFFECTS_LOOP    ;NO, START AGAIN
EFFECTS_DONE	LDA	TIME	        ;GET TIME VALUE
		JSR	WAIT	        ;DELAY
		LDA	#$00	        ;RESTORE ORIGINAL
		STA	TONE	        ;TONE VALUE
		JSR	RESET	        ;CLEAR SOUND CHIP
		RTS		        ;REGISTERS AND RETURN
